# PDFç”µè·¯å›¾æœç´¢ç³»ç»Ÿ - éƒ¨ç½²æ“ä½œæ‰‹å†Œ

## ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡æœåŠ¡å™¨è¿æ¥

### 1.1 è·å–æœåŠ¡å™¨ä¿¡æ¯
åœ¨è…¾è®¯äº‘æ§åˆ¶å°è·å–ï¼š
- æœåŠ¡å™¨å…¬ç½‘IPï¼šä¾‹å¦‚ `123.456.789.0`
- SSHç™»å½•ç”¨æˆ·åï¼šé€šå¸¸æ˜¯ `root` æˆ– `ubuntu`
- SSHå¯†ç æˆ–å¯†é’¥æ–‡ä»¶

### 1.2 SSHç™»å½•æœåŠ¡å™¨

**Windowsç”¨æˆ·**ï¼ˆä½¿ç”¨PowerShellæˆ–CMDï¼‰ï¼š
```bash
ssh root@ä½ çš„æœåŠ¡å™¨IP
# ä¾‹å¦‚ï¼šssh root@123.456.789.0
# é¦–æ¬¡è¿æ¥ä¼šæç¤ºæ˜¯å¦ä¿¡ä»»ï¼Œè¾“å…¥ yes
# ç„¶åè¾“å…¥å¯†ç 
```

**æˆ–ä½¿ç”¨SSHå¯†é’¥**ï¼š
```bash
ssh -i ä½ çš„å¯†é’¥æ–‡ä»¶.pem root@ä½ çš„æœåŠ¡å™¨IP
```

---

## ç¬¬äºŒæ­¥ï¼šåˆå§‹åŒ–æœåŠ¡å™¨ç¯å¢ƒ

### 2.1 æ›´æ–°ç³»ç»Ÿ
```bash
sudo apt update
sudo apt upgrade -y
```

### 2.2 å®‰è£…Node.js 18
```bash
# æ·»åŠ NodeSourceä»“åº“
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -

# å®‰è£…Node.js
sudo apt install -y nodejs

# éªŒè¯å®‰è£…
node -v    # åº”æ˜¾ç¤º v18.x.x
npm -v     # åº”æ˜¾ç¤º npmç‰ˆæœ¬
```

### 2.3 å®‰è£…PM2ï¼ˆè¿›ç¨‹ç®¡ç†å™¨ï¼‰
```bash
sudo npm install -g pm2

# éªŒè¯å®‰è£…
pm2 -v
```

### 2.4 å®‰è£…Nginx
```bash
sudo apt install -y nginx

# éªŒè¯å®‰è£…
nginx -v

# å¯åŠ¨Nginx
sudo systemctl start nginx
sudo systemctl enable nginx
```

### 2.5 é…ç½®é˜²ç«å¢™
```bash
# å…è®¸HTTPå’ŒSSH
sudo ufw allow 80/tcp
sudo ufw allow 22/tcp
sudo ufw allow 443/tcp  # å¦‚æœå°†æ¥è¦ç”¨HTTPS
sudo ufw --force enable

# æŸ¥çœ‹çŠ¶æ€
sudo ufw status
```

**åŒæ—¶ç¡®ä¿åœ¨è…¾è®¯äº‘æ§åˆ¶å°çš„å®‰å…¨ç»„ä¸­å¼€æ”¾äº†80ç«¯å£ï¼**

---

## ç¬¬ä¸‰æ­¥ï¼šå…‹éš†é¡¹ç›®

### 3.1 åˆ›å»ºéƒ¨ç½²ç›®å½•
```bash
sudo mkdir -p /var/www/pdf-search
sudo chown -R $USER:$USER /var/www/pdf-search
cd /var/www/pdf-search
```

### 3.2 å…‹éš†GitHubä»“åº“
```bash
git clone https://github.com/sakura-snowy/pdf-circuit-search.git .
# æ³¨æ„æœ€åæœ‰ä¸ªç‚¹ . è¡¨ç¤ºå…‹éš†åˆ°å½“å‰ç›®å½•
```

### 3.3 éªŒè¯æ–‡ä»¶
```bash
ls -la
# åº”è¯¥çœ‹åˆ° backend, frontend, pdfs ç­‰ç›®å½•
```

---

## ç¬¬å››æ­¥ï¼šéƒ¨ç½²åç«¯

### 4.1 å®‰è£…åç«¯ä¾èµ–
```bash
cd /var/www/pdf-search/backend
npm install --production
```

### 4.2 é…ç½®ç¯å¢ƒå˜é‡
```bash
# å¤åˆ¶ç”Ÿäº§ç¯å¢ƒé…ç½®
cp .env.production .env

# æŸ¥çœ‹é…ç½®ï¼ˆå¯é€‰ï¼‰
cat .env
```

### 4.3 ç¼–è¯‘TypeScriptä»£ç 
```bash
npm run build
# ç¼–è¯‘åçš„æ–‡ä»¶åœ¨ dist/ ç›®å½•
```

### 4.4 ä½¿ç”¨PM2å¯åŠ¨åç«¯
```bash
cd /var/www/pdf-search/backend

# å¯åŠ¨æœåŠ¡
pm2 start dist/index.js --name pdf-search-backend

# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs pdf-search-backend

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 save
pm2 startup
# ä¼šè¾“å‡ºä¸€æ¡å‘½ä»¤ï¼Œå¤åˆ¶å¹¶æ‰§è¡Œå®ƒ
```

### 4.5 æµ‹è¯•åç«¯API
```bash
curl http://localhost:3001/health
# åº”è¿”å›ï¼š{"status":"ok","timestamp":"..."}
```

---

## ç¬¬äº”æ­¥ï¼šéƒ¨ç½²å‰ç«¯

### 5.1 å®‰è£…å‰ç«¯ä¾èµ–
```bash
cd /var/www/pdf-search/frontend
npm install --legacy-peer-deps
```

### 5.2 æ„å»ºå‰ç«¯
```bash
npm run build
# æ„å»ºäº§ç‰©åœ¨ dist/ ç›®å½•
```

### 5.3 éªŒè¯æ„å»ºç»“æœ
```bash
ls -lh dist/
# åº”è¯¥çœ‹åˆ° index.html, assets/ ç­‰æ–‡ä»¶
```

---

## ç¬¬å…­æ­¥ï¼šä¸Šä¼ PDFæ–‡ä»¶

### æ–¹æ³•1ï¼šä»æœ¬åœ°ä¸Šä¼ ï¼ˆæ¨èï¼‰

**åœ¨ä½ çš„æœ¬åœ°ç”µè„‘ä¸Šæ‰§è¡Œ**ï¼ˆæ‰“å¼€æ–°çš„ç»ˆç«¯ï¼‰ï¼š
```bash
# Windows PowerShell æˆ– CMD
scp -r "C:\Users\sakura\OneDrive\æ¡Œé¢\pdf\*.pdf" root@ä½ çš„æœåŠ¡å™¨IP:/var/www/pdf-search/pdfs/

# ä¾‹å¦‚ï¼š
# scp -r "C:\Users\sakura\OneDrive\æ¡Œé¢\pdf\*.pdf" root@123.456.789.0:/var/www/pdf-search/pdfs/
```

### æ–¹æ³•2ï¼šåœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨wget/curlä¸‹è½½
å¦‚æœPDFæ–‡ä»¶åœ¨ç½‘ä¸Šï¼Œå¯ä»¥ç›´æ¥åœ¨æœåŠ¡å™¨ä¸‹è½½ï¼š
```bash
cd /var/www/pdf-search/pdfs
wget https://your-url/file.pdf
```

### æ–¹æ³•3ï¼šä½¿ç”¨FTPå·¥å…·
ä½¿ç”¨FileZillaç­‰FTPå·¥å…·ä¸Šä¼ åˆ° `/var/www/pdf-search/pdfs/` ç›®å½•

### éªŒè¯PDFæ–‡ä»¶
```bash
ls -lh /var/www/pdf-search/pdfs/
# åº”è¯¥çœ‹åˆ°ä½ çš„PDFæ–‡ä»¶
```

---

## ç¬¬ä¸ƒæ­¥ï¼šé…ç½®Nginx

### 7.1 ç¼–è¾‘Nginxé…ç½®
```bash
cd /var/www/pdf-search

# ç¼–è¾‘nginx.confï¼Œä¿®æ”¹åŸŸå/IP
nano nginx.conf
```

**ä¿®æ”¹è¿™ä¸€è¡Œ**ï¼š
```nginx
server_name your_domain.com;
```
æ”¹ä¸ºä½ çš„æœåŠ¡å™¨IPï¼š
```nginx
server_name 123.456.789.0;  # æ›¿æ¢ä¸ºä½ çš„å®é™…IP
```

æŒ‰ `Ctrl+O` ä¿å­˜ï¼Œ`Ctrl+X` é€€å‡º

### 7.2 å¤åˆ¶é…ç½®åˆ°Nginx
```bash
# å¤åˆ¶é…ç½®æ–‡ä»¶
sudo cp nginx.conf /etc/nginx/sites-available/pdf-search

# åˆ›å»ºè½¯é“¾æ¥
sudo ln -sf /etc/nginx/sites-available/pdf-search /etc/nginx/sites-enabled/pdf-search

# åˆ é™¤é»˜è®¤é…ç½®ï¼ˆå¯é€‰ï¼‰
sudo rm -f /etc/nginx/sites-enabled/default

# æµ‹è¯•é…ç½®
sudo nginx -t
# åº”æ˜¾ç¤ºï¼šsyntax is ok, test is successful
```

### 7.3 é‡å¯Nginx
```bash
sudo systemctl restart nginx

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status nginx
```

---

## ç¬¬å…«æ­¥ï¼šéªŒè¯éƒ¨ç½²

### 8.1 æ£€æŸ¥åç«¯æœåŠ¡
```bash
pm2 status
# åº”æ˜¾ç¤º pdf-search-backend ä¸º online çŠ¶æ€

curl http://localhost:3001/health
# åº”è¿”å› JSON æ ¼å¼çš„å¥åº·æ£€æŸ¥ä¿¡æ¯
```

### 8.2 æ£€æŸ¥å‰ç«¯æ–‡ä»¶
```bash
ls -la /var/www/pdf-search/frontend/dist/
# åº”è¯¥æœ‰ index.html ç­‰æ–‡ä»¶
```

### 8.3 è®¿é—®ç½‘ç«™

**åœ¨æµè§ˆå™¨ä¸­è®¿é—®**ï¼š
```
http://ä½ çš„æœåŠ¡å™¨IP
```

ä¾‹å¦‚ï¼š`http://123.456.789.0`

ä½ åº”è¯¥èƒ½çœ‹åˆ°ï¼š
1. âœ… PDFæ–‡æ¡£åˆ—è¡¨é¡µé¢
2. âœ… å¯ä»¥ç‚¹å‡»æŸ¥çœ‹PDF
3. âœ… å¯ä»¥æœç´¢å…³é”®è¯

---

## å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1ï¼šæ— æ³•è®¿é—®ç½‘ç«™

**æ£€æŸ¥æ¸…å•**ï¼š
```bash
# 1. æ£€æŸ¥NginxçŠ¶æ€
sudo systemctl status nginx

# 2. æ£€æŸ¥Nginxé”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log

# 3. æ£€æŸ¥é˜²ç«å¢™
sudo ufw status

# 4. æ£€æŸ¥åç«¯æœåŠ¡
pm2 status
pm2 logs pdf-search-backend
```

**è…¾è®¯äº‘æ§åˆ¶å°æ£€æŸ¥**ï¼š
- è¿›å…¥"å®‰å…¨ç»„"è®¾ç½®
- ç¡®ä¿å…¥ç«™è§„åˆ™ä¸­æœ‰ï¼š
  - HTTP (80ç«¯å£)
  - SSH (22ç«¯å£)

### é—®é¢˜2ï¼šAPIè¯·æ±‚å¤±è´¥

```bash
# æ£€æŸ¥åç«¯æ—¥å¿—
pm2 logs pdf-search-backend --lines 50

# æµ‹è¯•åç«¯
curl http://localhost:3001/api/pdfs

# é‡å¯åç«¯
pm2 restart pdf-search-backend
```

### é—®é¢˜3ï¼šPDFæ— æ³•åŠ è½½

```bash
# æ£€æŸ¥PDFæ–‡ä»¶
ls -lh /var/www/pdf-search/pdfs/

# æ£€æŸ¥æ–‡ä»¶æƒé™
sudo chown -R www-data:www-data /var/www/pdf-search/pdfs/
sudo chmod -R 755 /var/www/pdf-search/pdfs/

# æ£€æŸ¥åç«¯æ—¥å¿—
pm2 logs pdf-search-backend
```

---

## åç»­ç®¡ç†

### é‡å¯æœåŠ¡
```bash
# é‡å¯åç«¯
pm2 restart pdf-search-backend

# é‡å¯Nginx
sudo systemctl restart nginx

# é‡å¯å…¨éƒ¨
pm2 restart all && sudo systemctl restart nginx
```

### æŸ¥çœ‹æ—¥å¿—
```bash
# åç«¯æ—¥å¿—
pm2 logs pdf-search-backend

# Nginxè®¿é—®æ—¥å¿—
sudo tail -f /var/log/nginx/access.log

# Nginxé”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log
```

### æ›´æ–°ä»£ç 
```bash
cd /var/www/pdf-search

# æ‹‰å–æœ€æ–°ä»£ç 
git pull

# é‡æ–°æ„å»ºå‰ç«¯
cd frontend
npm run build

# é‡æ–°ç¼–è¯‘åç«¯
cd ../backend
npm run build

# é‡å¯åç«¯æœåŠ¡
pm2 restart pdf-search-backend
```

---

## é…ç½®HTTPSï¼ˆå¯é€‰ä½†æ¨èï¼‰

### ä½¿ç”¨Let's Encryptå…è´¹è¯ä¹¦

```bash
# å®‰è£…certbot
sudo apt install certbot python3-certbot-nginx

# è·å–è¯ä¹¦ï¼ˆéœ€è¦åŸŸåï¼‰
sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

---

## å®Œæˆï¼

ğŸ‰ æ­å–œï¼éƒ¨ç½²å®Œæˆï¼

ç°åœ¨ä½ çš„ç³»ç»Ÿåº”è¯¥å¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š
- **ç½‘ç«™**: http://ä½ çš„æœåŠ¡å™¨IP
- **API**: http://ä½ çš„æœåŠ¡å™¨IP/api

**å»ºè®®åç»­æ“ä½œ**ï¼š
1. é…ç½®åŸŸåå’ŒHTTPS
2. è®¾ç½®å®šæœŸå¤‡ä»½
3. ç›‘æ§æœåŠ¡å™¨èµ„æºä½¿ç”¨æƒ…å†µ

å¦‚æœ‰é—®é¢˜ï¼ŒæŸ¥çœ‹ DEPLOY.md æˆ–æäº¤ GitHub Issueï¼
